os: linux
dist: bionic

addons:
  apt:
    sources:
      - sourceline: 'deb [arch=amd64] http://dl.google.com/linux/chrome/deb/ stable main'
        key_url: 'https://dl.google.com/linux/linux_signing_key.pub'
    packages:
      - google-chrome-stable

services:
  - xvfb

language: node_js

node_js:
  - "10"

script:
  - npm run lint
  - npm run test:cover
  - npm run e2e

after_success:
  - npm run coveralls
  - bash <(curl -Ls https://coverage.codacy.com/get.sh) report -l Javascript -r ./coverage/lcov.info

before_deploy:
  - '[ ! -d dist/ ] && npm run build'
  - '[ ! -f dist-${TRAVIS_TAG}.tar.gz ] && tar -zcf dist-${TRAVIS_TAG}.tar.gz dist/'

deploy:
  - provider: cloudfoundry
    api: https://api.run.pcfone.io
    username: $CF_USERNAME
    password: $CF_PASSWORD
    organization: pivot-jsharpe
    space: development
    on:
      tags: true
  - provider: releases
    api_key: $GITHUB_TOKEN
    name: ${TRAVIS_TAG}
    file: dist-${TRAVIS_TAG}.tar.gz
    on:
      tags: true
